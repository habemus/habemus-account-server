<html>
<head>
  <title>password reset</title>


  <script
    src="https://code.jquery.com/jquery-3.1.1.min.js"
    integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
    crossorigin="anonymous">
  </script>

  <script type="text/javascript">
    // http://stackoverflow.com/questions/901115/how-can-i-get-query-string-values-in-javascript
    function getParameterByName(name, url) {
      if (!url) url = window.location.href;
      name = name.replace(/[\[\]]/g, "\\$&");
      var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
          results = regex.exec(url);
      if (!results) return null;
      if (!results[2]) return '';
      return decodeURIComponent(results[2].replace(/\+/g, " "));
    }

    function parseDataFromLocation() {
      return {
        code: getParameterByName('code', window.location.href),
        username: getParameterByName('username', window.location.href),
        submitURL: getParameterByName('submitURL', window.location.href),
      };
    }


    $(function () {
      var resetData = parseDataFromLocation();

      var $resetForm       = $('#password-reset');
      var $password        = $resetForm.find('[name="password"]');
      var $passwordConfirm = $resetForm.find('[name="password-confirm"]');

      $resetForm.on('submit', function (e) {
        e.preventDefault();
        e.stopPropagation();

        var password        = $password.val();
        var passwordConfirm = $passwordConfirm.val();

        if (password !== passwordConfirm) {
          alert('passwords do not match');

          return;
        }

        $.ajax({
          method: 'POST',
          url: resetData.submitURL,
          // important!
          contentType: 'application/json',
          data: JSON.stringify({
            username: resetData.username,
            code: resetData.code,
            password: password,
          }),
        })
        .done(function () {
          alert('password reset success');
        })
        .fail(function (err) {
          console.warn('password reset error', err);
        })
        .always(function () {

        });

      });
    });
    
  </script>
</head>
<body>

  <form id="password-reset">

    <label>
      <span>new password</span>
      <input
        type="password"
        name="password"
        class="h-account-password"
        placeholder="password"
        required
        minlength="6">
    </label>
    <label>
      <span>confirm your password</span>
      <input
        type="password"
        name="password-confirm"
        class="h-account-password-confirm"
        placeholder="confirm password"
        required
        minlength="6">
    </label>

    <button type="submit">submit</button>

  </form>
</body>
</html>